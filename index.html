<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Il Rituale â€” Combinazione di Simboli</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap');

  :root{
    --bg:#050505; --fg:#e6e6e6; --muted:#9aa0a6;
    --accent:#2bff88; --accent2:#6bffda;
    --card:#0d0d0d; --ok:#22c55e; --err:#ff4d4d;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:radial-gradient(circle at 50% 15%, #111 0%, #000 80%);color:var(--fg);font-family:'Cinzel Decorative', serif}
  .page{max-width:1600px;margin:0 auto;padding:clamp(12px,2vw,24px);display:flex;flex-direction:column;align-items:center;text-align:center}

  /* HERO dimezzata */
  .hero{width:100%;max-width:min(500px,50vw);margin:0 auto clamp(10px,2vw,18px)}
  .hero img{width:100%;height:auto;display:block;border-radius:10px}
  .hero-fallback{width:100%;padding:clamp(16px,2vw,28px);border:2px dashed rgba(43,255,136,.35);border-radius:10px;color:var(--accent2)}

  h1{font-size:clamp(24px,5vw,42px);margin:clamp(8px,1.5vw,12px) 0;color:var(--accent);text-shadow:0 0 12px var(--accent),0 0 28px var(--accent2);letter-spacing:.06em}
  .sub{color:var(--muted);margin:0 0 clamp(12px,2vw,18px);font-size:clamp(14px,2vw,18px)}

  /* COMBINAZIONE */
  .panel{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(220px,42vw),1fr));gap:clamp(12px,2vw,20px);width:100%;max-width:min(1200px,96vw);padding:clamp(12px,2vw,16px);border-radius:16px;background:rgba(20,20,20,.85);box-shadow:0 0 40px rgba(43,255,136,.25),inset 0 0 20px rgba(43,255,136,.15)}
  .slot{background:radial-gradient(300px 300px at 50% 30%, rgba(43,255,136,.08), transparent 70%), var(--card);border:2px solid rgba(43,255,136,.3);border-radius:16px;padding:clamp(8px,1.8vw,12px);display:flex;align-items:center;justify-content:center;gap:clamp(8px,1.5vw,10px);min-height:clamp(200px,28vw,320px);box-shadow:inset 0 0 20px rgba(43,255,136,.15)}
  .symbol{flex:1;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);border:1px solid rgba(43,255,136,.4);box-shadow:0 0 20px rgba(43,255,136,.15),inset 0 0 15px rgba(43,255,136,.1);border-radius:12px;overflow:hidden}
  .symbol img{width:100%;height:100%;max-width:clamp(160px,22vw,280px);max-height:clamp(160px,22vw,280px);object-fit:contain}
  .fallback{color:var(--accent2);font-size:.92rem;padding:6px;text-align:center}
  .arrow{width:clamp(36px,4.5vw,44px);height:clamp(36px,4.5vw,44px);display:flex;align-items:center;justify-content:center;font-size:clamp(18px,2.5vw,20px);cursor:pointer;color:var(--fg);background:rgba(30,30,30,.8);border:1px solid rgba(43,255,136,.3);border-radius:8px;transition:all 0.2s}
  .arrow:hover{background:rgba(43,255,136,.15);transform:scale(1.1)}
  .action{margin:clamp(12px,2vw,16px) 0;display:flex;gap:clamp(8px,1.5vw,12px);justify-content:center}
  button{appearance:none;border:0;cursor:pointer;border-radius:8px;padding:10px 16px;font-weight:700;font-size:1rem;background:rgba(30,30,30,.9);color:var(--fg);border:2px solid rgba(43,255,136,.3);font-family:'Cinzel Decorative',serif;transition:all 0.2s}
  button:hover{background:rgba(43,255,136,.15);transform:scale(1.05)}
  .msg{min-height:28px;font-size:1.1rem;margin-top:6px}
  .success{color:var(--ok)} .fail{color:var(--err)}
  .footer{margin-top:clamp(12px,2vw,18px);color:var(--accent2);font-size:.95rem}

  /* RITUALE */
  #rituale{display:none;width:100%;max-width:min(1100px,96vw);margin:clamp(16px,2.5vw,24px) auto 0}
  .rituale-text{margin:12px auto 8px;line-height:1.45;color:var(--fg);font-size:clamp(14px,2vw,18px)}
  .rit-title{font-size:clamp(22px,4vw,36px);margin:8px 0 12px;color:var(--accent);text-shadow:0 0 10px var(--accent),0 0 24px var(--accent2);letter-spacing:.08em}
  .pentacolo-wrapper{position:relative;width:100%;max-width:400px;margin:0 auto}
  .pentacolo{position:relative;width:100%;padding-top:100%}
  .pentacolo svg{position:absolute;top:0;left:0;width:100%;height:100%;transform:rotate(180deg)}
  .rit-field{position:absolute;width:70%;left:50%;transform:translateX(-50%)}
  .rit-field input{width:100%;padding:8px 12px;border-radius:8px;border:2px solid rgba(43,255,136,.35);background:rgba(10,10,10,.95);color:var(--fg);font-size:14px;text-align:center}
  .rf-top{top:15%} .rf-mid{top:43%} .rf-bottom{top:71%}
  .rit-btn-wrapper{text-align:center;margin-top:20px}
  .rit-msg{min-height:20px;margin-top:16px;font-size:1rem;text-align:center}

  /* GIOCO */
  #game{display:none;width:100%;max-width:min(960px,96vw);margin:28px auto 0;text-align:center}
  #game h2{margin:8px 0 6px;font-size:clamp(20px,4vw,28px);color:var(--accent);text-shadow:0 0 10px var(--accent)}
  #canvasWrap{background:#111;border:2px solid rgba(43,255,136,.3);border-radius:10px}
  canvas{display:block;width:100%;height:auto;background:#000}
  .hud{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(0,0,0,.5);border-top:1px solid rgba(43,255,136,.2)}
  .score-display{color:var(--accent2);font-weight:bold}
  .win{color:var(--ok);margin-top:10px}
  .game-over-msg{color:var(--err);margin-top:10px}
</style>
</head>
<body>
<main class="page">
  <div class="hero" id="heroBox"></div>
  <h1>Combinazione di Simboli</h1>
  <p class="sub">Allinea i quattro simboli corretti per risvegliare l'oscuro portale.</p>
  <section class="panel" id="panel"></section>
  <div class="action"><button id="shuffle">Mescola</button><button id="check">Verifica</button></div>
  <div id="message" class="msg"></div>
  <div class="footer" id="hintBox"></div>

  <section id="rituale">
    <p class="rituale-text" id="ritText"></p>
    <div class="rit-title">Inizia il Rituale</div>
    <div class="pentacolo-wrapper">
      <div class="pentacolo">
        <svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="rgba(43,255,136,.35)" stroke-width="2"/><polygon points="50,6 61,40 96,40 67,60 78,94 50,73 22,94 33,60 4,40 39,40" fill="none" stroke="rgba(43,255,136,.55)" stroke-width="2"/></svg>
        <div class="rit-field rf-top"><input id="f1" type="text" placeholder="Primo ingrediente"></div>
        <div class="rit-field rf-mid"><input id="f2" type="text" placeholder="Secondo ingrediente"></div>
        <div class="rit-field rf-bottom"><input id="f3" type="text" placeholder="Terzo ingrediente"></div>
      </div>
      <div class="rit-btn-wrapper"><button id="completeBtn">Completa Rituale</button></div>
    </div>
    <div id="ritMsg" class="rit-msg"></div>
  </section>

  <section id="game">
    <h2>La Corsa della Zucca ðŸŽƒ</h2>
    <div id="canvasWrap"><canvas id="runner" width="900" height="300"></canvas></div>
    <div class="hud">Punti: <span class="score-display" id="score">0</span></div>
    <div class="win" id="winMsg" style="display:none">Hai superato il livello!</div>
    <div class="game-over-msg" id="gameOverMsg" style="display:none">Game Over! Riprova.</div>
    <button id="startGame">â–¶ Gioca</button> <button id="restartGame" style="display:none">â†» Riprova</button>
  </section>
</main>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const hero=document.getElementById('heroBox');
  const b=new Image(); b.src='media/home.png?v=2'; b.alt='Il Rituale';
  b.onload=()=>hero.appendChild(b);
  b.onerror=()=>hero.innerHTML='<div class="hero-fallback">MANCANTE: media/home.png</div>';

  const SYMBOLS=Array.from({length:12},(_,i)=>({id:String(i+1),src:`./media/${i+1}.png?v=2`}));
  const TARGET=atob("MSwyLDMsNA==").split(",");

  const HINTS=["Spesso gli oggetti...","Le scope delle streghe...","Una volta ho sentito la storia..."];
  document.getElementById('hintBox').textContent="Suggerimento: "+HINTS[Math.floor(Math.random()*HINTS.length)];

  const panel=document.getElementById('panel'), message=document.getElementById('message'),
        rituale=document.getElementById('rituale'), ritText=document.getElementById('ritText'),
        gameSec=document.getElementById('game');
  let state=[], ritualeShown=false;

  function renderSymbol(el,idx){el.innerHTML='';const img=new Image();img.src=SYMBOLS[idx].src;img.onerror=()=>el.innerHTML='MANCANTE';el.appendChild(img);}
  function createSlot(i){const wrap=document.createElement('div');wrap.className='slot';const L=document.createElement('div');L.className='arrow';L.textContent='â—€';const S=document.createElement('div');S.className='symbol';const R=document.createElement('div');R.className='arrow';R.textContent='â–¶';wrap.append(L,S,R);state[i]=Math.floor(Math.random()*SYMBOLS.length);renderSymbol(S,state[i]);L.onclick=()=>{state[i]=(state[i]-1+SYMBOLS.length)%SYMBOLS.length;renderSymbol(S,state[i]);};R.onclick=()=>{state[i]=(state[i]+1)%SYMBOLS.length;renderSymbol(S,state[i]);};return wrap;}
  function build(){panel.innerHTML='';state=[];for(let i=0;i<4;i++)panel.appendChild(createSlot(i));}
  function check(){const picked=state.map(idx=>SYMBOLS[idx].id);const ok=picked.every((id,i)=>id===TARGET[i]);if(ok){message.className='success';message.textContent='âœ“ Combinazione corretta!';if(!ritualeShown){ritText.textContent="Bene, molto bene...";rituale.style.display='block';rituale.scrollIntoView();ritualeShown=true;}}else{message.className='fail';message.textContent='âœ— Errata';}}
  document.getElementById('shuffle').onclick=build;document.getElementById('check').onclick=check;build();

  function norm(s){return s.normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase();}
  function classify(t){const v=norm(t);if(v.includes('candela')&&v.includes('nera'))return 'CANDLE';if(v.includes('coltello')&&v.includes('arruggin')&&v.includes('bestia'))return 'KNIFE';if(v.includes('peli')&&v.includes('zombie')&&v.includes('femmina'))return 'HAIR';return null;}
  document.getElementById('completeBtn').onclick=()=>{const f1=document.getElementById('f1').value,f2=document.getElementById('f2').value,f3=document.getElementById('f3').value;const arr=[classify(f1),classify(f2),classify(f3)];if(arr.includes('CANDLE')&&arr.includes('KNIFE')&&arr.includes('HAIR')){document.getElementById('ritMsg').textContent='âœ¨ Il cerchio si illumina!';gameSec.style.display='block';gameSec.scrollIntoView();}else{document.getElementById('ritMsg').textContent='Ingrediente sbagliato!';}};

  const cvs=document.getElementById('runner'),ctx=cvs.getContext('2d');const playerImg=new Image();playerImg.src='media/zucca.png?v=2';const monsterImgs=['mostro1.png','mostro2.png','mostro3.png','mostro4.png'].map(n=>{const im=new Image();im.src='media/'+n+'?v=2';return im;});
  let running=false,score=0,obstacles=[];const ground=cvs.height-40;const player={x:80,y:ground-40,w:40,h:40,vy:0,onGround:true};function spawn(){const img=monsterImgs[Math.floor(Math.random()*monsterImgs.length)];obstacles.push({x:cvs.width,y:ground-40,w:40,h:40,img});}
  function loop(ts){if(!running)return;ctx.clearRect(0,0,cvs.width,cvs.height);ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);for(let o of obstacles){o.x-=5;ctx.beginPath();ctx.ellipse(o.x+o.w/2,ground+5,o.w/2,5,0,0,Math.PI*2);ctx.fillStyle='rgba(0,0,0,.3)';ctx.fill();ctx.drawImage(o.img,o.x,o.y,o.w,o.h);}requestAnimationFrame(loop);}
  document.getElementById('startGame').onclick=()=>{running=true;requestAnimationFrame(loop);}
});
</script>
</body>
</html>
